<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stochastic SIR Model • bayesSSM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stochastic SIR Model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesSSM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9019</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bayesSSM.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/detailed-overview.html">Detailed Overview of bayesSSM Package</a></li>
    <li><a class="dropdown-item" href="../articles/stochastic-sir-model.html">Stochastic SIR Model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BjarkeHautop/bayesSSM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stochastic SIR Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BjarkeHautop/bayesSSM/blob/master/vignettes/articles/stochastic-sir-model.Rmd" class="external-link"><code>vignettes/articles/stochastic-sir-model.Rmd</code></a></small>
      <div class="d-none name"><code>stochastic-sir-model.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BjarkeHautop/bayesSSM" class="external-link">bayesSSM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/twolodzko/extraDistr" class="external-link">extraDistr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span> <span class="co"># For matrix exponentiation</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Matrix'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:tidyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand, pack, unpack</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'expm'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:Matrix':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1405</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="stochastic-sir-model">Stochastic SIR Model<a class="anchor" aria-label="anchor" href="#stochastic-sir-model"></a>
</h2>
<p>We consider a stochastic SIR (Susceptible–Infectious–Recovered) model
for the spread of an infectious disease in a <strong>closed
population</strong> of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
meaning there are no births, deaths, or migration. The population is
divided into three compartments: susceptible (S), infectious (I), and
recovered (R). Initially, all individuals are susceptible except for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
infectious individuals.</p>
<p>Note that most of the literature on SIR models assumes a
<strong>deterministic</strong> model, where the compartments are treated
as continuous and are described by ordinary differential equations
(ODEs).</p>
<p>Each infectious individual makes contact with any given member of the
population according to a <strong>time-homogeneous Poisson
process</strong> with rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>/</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\lambda/N</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda &gt; 0</annotation></semantics></math>.
Thus, each infectious individual makes contact with any other individual
at an overall rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
independent of the population size.</p>
<p>The duration of the infectious period for each individual is assumed
to follow an <strong>exponential distribution</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>∼</mo><mtext mathvariant="normal">Exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>γ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
I \sim \text{Exp}(\gamma),
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\gamma &gt; 0</annotation></semantics></math>
is the recovery rate.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S(t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(t)</annotation></semantics></math>
denote the number of susceptible and infectious individuals at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t \geq 0</annotation></semantics></math>,
respectively. Under the assumptions above, the process
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mi>t</mi><mo>≥</mo><mn>0</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">
\{(S(t), I(t)) : t \geq 0\}
</annotation></semantics></math> forms a <strong>continuous-time Markov
process</strong>, since both infection and recovery events are
exponentially distributed and are therefore memoryless. Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is fixed, we have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>N</mi><mo>−</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(t) = N - S(t) - I(t)</annotation></semantics></math>,
and thus the process can be described by the pair
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(S(t), I(t))</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="transition-rates">Transition Rates<a class="anchor" aria-label="anchor" href="#transition-rates"></a>
</h3>
<ul>
<li>
<p><strong>Infection Event:</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>i</mi><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>→</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
(s, i, r) \to (s - 1, i + 1, r)
</annotation></semantics></math></p>
<p>occurs at rate</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>λ</mi><mi>N</mi></mfrac><mspace width="0.167em"></mspace><mi>s</mi><mspace width="0.167em"></mspace><mi>i</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
\frac{\lambda}{N} \, s \, i,
</annotation></semantics></math></p>
<p>for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s &gt; 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i &gt; 0</annotation></semantics></math>.</p>
</li>
<li>
<p><strong>Recovery Event:</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>i</mi><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>→</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
(s, i, r) \to (s, i - 1, r + 1)
</annotation></semantics></math></p>
<p>occurs at rate</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mspace width="0.167em"></mspace><mi>i</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
\gamma \, i,
</annotation></semantics></math></p>
<p>for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i &gt; 0</annotation></semantics></math>.</p>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="partial-observations-and-noisy-measurements">Partial Observations and Noisy Measurements<a class="anchor" aria-label="anchor" href="#partial-observations-and-noisy-measurements"></a>
</h3>
<p>Suppose we only observe the initial state and the number of
infectious individuals
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(t)</annotation></semantics></math>
at discrete time points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">t = 0, 1, \ldots, T</annotation></semantics></math>.
The true number of infectious individuals is unobserved (latent), and
instead we observe a <strong>noisy measurement</strong> that may either
overestimate or underestimate the true count.</p>
<p>We model the observed counts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">Y_t</annotation></semantics></math>
in this article using a <strong>Poisson observation model</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>t</mi></msub><mo>∣</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mo>Pois</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
Y_t \mid I(t) \sim \operatorname{Pois}(I(t)).
</annotation></semantics></math> To account for over-dispersion, one
could instead use a negative binomial observation model.</p>
<p>We are now in a State Space Model (SSM) setup, where the latent state
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\bigl(S(t), I(t)\bigr)</annotation></semantics></math>,
and the observations are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">Y_t</annotation></semantics></math>.
Note that due to the memoryless property of the exponential
distribution, the latent state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(S(t), I(t))</annotation></semantics></math>
is fully determined by the initial state and the sequence of infection
and recovery events that have occurred up to time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
thus a Markov process.</p>
</div>
</div>
<div class="section level2">
<h2 id="why-standard-mcmc-methods-are-infeasible">Why Standard MCMC Methods Are Infeasible<a class="anchor" aria-label="anchor" href="#why-standard-mcmc-methods-are-infeasible"></a>
</h2>
<p>If one wanted to use standard MCMC methods to estimate the joint
posterior of the parameters and latent states, one would need to compute
the exact transition probabilities for the SIR model, which quickly
becomes infeasible as the number of infectious individuals increases. We
illustrate how this can be done using matrix exponentiation for small
populations.</p>
<p>The probability distribution of the state at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is given by:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mi>Q</mi><mi>t</mi></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">
P(t) = e^{Qt},
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Q</mi><annotation encoding="application/x-tex">Q</annotation></semantics></math>
is the generator matrix of the Markov process, which contains the
transition rates between states.</p>
<p>We define functions below to generate the state space for a small SIR
system, build the generator matrix, and compute the transition
probabilities at a given time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate state space for small SIR system</span></span>
<span><span class="va">generate_sir_states</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Returns all (s, i) pairs where s + i &lt;= N</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>s <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">N</span>, i <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">states</span>, <span class="va">s</span> <span class="op">+</span> <span class="va">i</span> <span class="op">&lt;=</span> <span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="va">states</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">states</span><span class="op">$</span><span class="va">s</span>, <span class="va">states</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">states</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Build generator matrix Q</span></span>
<span><span class="va">build_generator_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">states</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_states</span>, <span class="va">n_states</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">states</span><span class="op">$</span><span class="va">s</span><span class="op">[</span><span class="va">k</span><span class="op">]</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">states</span><span class="op">$</span><span class="va">i</span><span class="op">[</span><span class="va">k</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">rate_infection</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span> <span class="op">*</span> <span class="va">s</span> <span class="op">*</span> <span class="va">i</span></span>
<span>    <span class="va">rate_recovery</span> <span class="op">&lt;-</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">i</span></span>
<span></span>
<span>    <span class="co"># Infection transition</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">s</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">next_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">states</span><span class="op">$</span><span class="va">s</span> <span class="op">==</span> <span class="va">next_state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">states</span><span class="op">$</span><span class="va">i</span> <span class="op">==</span> <span class="va">next_state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">Q</span><span class="op">[</span><span class="va">k</span>, <span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rate_infection</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Recovery transition</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">next_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">states</span><span class="op">$</span><span class="va">s</span> <span class="op">==</span> <span class="va">next_state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">states</span><span class="op">$</span><span class="va">i</span> <span class="op">==</span> <span class="va">next_state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">Q</span><span class="op">[</span><span class="va">k</span>, <span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rate_recovery</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Diagonal: exit rate</span></span>
<span>    <span class="va">Q</span><span class="op">[</span><span class="va">k</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">rate_infection</span> <span class="op">+</span> <span class="va">rate_recovery</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">Q</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute transition probabilities at time t</span></span>
<span><span class="va">compute_transition_probs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">N</span>, <span class="va">t</span>, <span class="va">init_state</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu">generate_sir_states</span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu">build_generator_matrix</span><span class="op">(</span><span class="va">states</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="va">Q</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span> <span class="co"># matrix exponential</span></span>
<span></span>
<span>  <span class="va">init_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">states</span><span class="op">$</span><span class="va">s</span> <span class="op">==</span> <span class="va">init_state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">states</span><span class="op">$</span><span class="va">i</span> <span class="op">==</span> <span class="va">init_state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">p_t</span> <span class="op">&lt;-</span> <span class="va">P</span><span class="op">[</span><span class="va">init_index</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    s <span class="op">=</span> <span class="va">states</span><span class="op">$</span><span class="va">s</span>,</span>
<span>    i <span class="op">=</span> <span class="va">states</span><span class="op">$</span><span class="va">i</span>,</span>
<span>    prob <span class="op">=</span> <span class="va">p_t</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This can then be run to compute the transition probabilities for a
given state and time point. For example, if we have a population of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">N=5</annotation></semantics></math>
with state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(S(t), I(t)) = (4, 1)</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
we can compute the transition probabilities for the next time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t+1</annotation></semantics></math>
as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example with very small population</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># Small population</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Time point</span></span>
<span><span class="va">init_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># (s, i)</span></span>
<span></span>
<span><span class="va">transition_probs</span> <span class="op">&lt;-</span> <span class="fu">compute_transition_probs</span><span class="op">(</span></span>
<span>  <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">N</span>, <span class="va">t</span>, <span class="va">init_state</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the most probable next states</span></span>
<span><span class="va">transition_probs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">transition_probs</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span>, <span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;    s i       prob</span></span>
<span><span class="co">#&gt; 19 4 0 0.27979546</span></span>
<span><span class="co">#&gt; 20 4 1 0.27253179</span></span>
<span><span class="co">#&gt; 18 3 2 0.14375879</span></span>
<span><span class="co">#&gt; 17 3 1 0.08872580</span></span>
<span><span class="co">#&gt; 15 2 3 0.06343076</span></span></code></pre></div>
<p>Note, that this scales poorly with larger populations, as the number
of states is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>N</mi><mo>+</mo><mn>2</mn></mrow><mrow><mn>2</mn><mo>,</mo></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
N+2 \choose 2,
</annotation></semantics></math> which for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">N=100</annotation></semantics></math>
is already over 5000 states. Thus, this whole approach is only feasible
for very small populations.</p>
</div>
<div class="section level2">
<h2 id="simulate-data">Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data"></a>
</h2>
<p>We will simulate data from the SIR model with the following
parameters: - At
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t=0</annotation></semantics></math>
we have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>90</mn></mrow><annotation encoding="application/x-tex">S(0) = 90</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">I(0) = 10</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R(0) = 0</annotation></semantics></math>.
- Infection rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">\lambda=1.5</annotation></semantics></math>
and removal rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\gamma=0.5</annotation></semantics></math>.
- We observe the initial state at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t=0</annotation></semantics></math>
complete, and then noisy version of infectious individuals at times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">t=1, \ldots, 10</annotation></semantics></math>
representing observations for each day.</p>
<p>We can simulate using the fact that we have two independent
exponential distribution, so an event occurs at rate of the sum of the
rates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Simulation settings and true parameters ---</span></span>
<span><span class="va">n_total</span> <span class="op">&lt;-</span> <span class="fl">500</span> <span class="co"># Total population size</span></span>
<span><span class="va">init_infected</span> <span class="op">&lt;-</span> <span class="fl">70</span> <span class="co"># Initially infectious individuals</span></span>
<span><span class="va">init_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_total</span> <span class="op">-</span> <span class="va">init_infected</span>, <span class="va">init_infected</span><span class="op">)</span> <span class="co"># (s, i) at time 0</span></span>
<span><span class="va">t_max</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># Total number of days to simulate</span></span>
<span><span class="va">true_lambda</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># True infection parameter</span></span>
<span><span class="va">true_gamma</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co"># True removal parameter</span></span>
<span></span>
<span><span class="co"># --- Functions for simulating the epidemic ---</span></span>
<span></span>
<span><span class="va">epidemic_step</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">n_total</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">t_end</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">t_end</span> <span class="op">&amp;&amp;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rate_infection</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">/</span> <span class="va">n_total</span><span class="op">)</span> <span class="op">*</span> <span class="va">s</span> <span class="op">*</span> <span class="va">i</span></span>
<span>    <span class="va">rate_removal</span> <span class="op">&lt;-</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">i</span></span>
<span>    <span class="va">rate_total</span> <span class="op">&lt;-</span> <span class="va">rate_infection</span> <span class="op">+</span> <span class="va">rate_removal</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">rate_total</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">rate_total</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">t</span> <span class="op">+</span> <span class="va">dt</span> <span class="op">&gt;</span> <span class="va">t_end</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">+</span> <span class="va">dt</span></span>
<span>    <span class="co"># Decide which event occurs:</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">rate_infection</span> <span class="op">/</span> <span class="va">rate_total</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Infection event</span></span>
<span>      <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>      <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Removal event</span></span>
<span>      <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">simulate_epidemic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">n_total</span>, <span class="va">init_infected</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">t_max</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">t_max</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="co"># initial state at t = 0</span></span>
<span>  <span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_total</span> <span class="op">-</span> <span class="va">init_infected</span>, <span class="va">init_infected</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">t_max</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">state</span> <span class="op">&lt;-</span> <span class="fu">epidemic_step</span><span class="op">(</span><span class="va">state</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">n_total</span><span class="op">)</span></span>
<span>    <span class="va">states</span><span class="op">[</span><span class="va">t</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">states</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we generate some data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate an epidemic dataset</span></span>
<span><span class="va">true_states</span> <span class="op">&lt;-</span> <span class="fu">simulate_epidemic</span><span class="op">(</span></span>
<span>  <span class="va">n_total</span>, <span class="va">init_infected</span>, <span class="va">true_lambda</span>, <span class="va">true_gamma</span>, <span class="va">t_max</span></span>
<span><span class="op">)</span></span>
<span><span class="va">latent_i</span> <span class="op">&lt;-</span> <span class="va">true_states</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">latent_i</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">latent_i</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display simulated data: time, susceptible, latent infectious, observed counts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">t_max</span>, s <span class="op">=</span> <span class="va">true_states</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, i <span class="op">=</span> <span class="va">true_states</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">observations</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    time   s   i   y</span></span>
<span><span class="co">#&gt; 1     1 391  88 103</span></span>
<span><span class="co">#&gt; 2     2 348 113 106</span></span>
<span><span class="co">#&gt; 3     3 307 132 114</span></span>
<span><span class="co">#&gt; 4     4 266 147 136</span></span>
<span><span class="co">#&gt; 5     5 221 164 155</span></span>
<span><span class="co">#&gt; 6     6 183 171 168</span></span>
<span><span class="co">#&gt; 7     7 155 159 154</span></span>
<span><span class="co">#&gt; 8     8 137 143 137</span></span>
<span><span class="co">#&gt; 9     9 118 139 147</span></span>
<span><span class="co">#&gt; 10   10 107 121 123</span></span></code></pre></div>
<p>And plot it:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to create a tidy dataset for ggplot</span></span>
<span><span class="va">prepare_data_for_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">states</span>, <span class="va">observations</span>, <span class="va">t_max</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Organize the data into a tidy format</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">t_max</span>,</span>
<span>    s <span class="op">=</span> <span class="va">states</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>    i <span class="op">=</span> <span class="va">states</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>    y <span class="op">=</span> <span class="va">observations</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Convert to long format for ggplot</span></span>
<span>  <span class="va">data_long</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"state"</span>, value <span class="op">=</span> <span class="st">"count"</span>, <span class="op">-</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data_long</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to plot the epidemic data</span></span>
<span><span class="va">plot_epidemic_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_long</span>, <span class="va">t_max</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"i"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"y"</span> <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Time (Days)"</span>, y <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Susceptible, Infected, and Observed Counts"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">t_max</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">data_long</span> <span class="op">&lt;-</span> <span class="fu">prepare_data_for_plot</span><span class="op">(</span><span class="va">true_states</span>, <span class="va">observations</span>, <span class="va">t_max</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="fu">plot_epidemic_data</span><span class="op">(</span><span class="va">data_long</span>, <span class="va">t_max</span><span class="op">)</span></span></code></pre></div>
<p><img src="stochastic-sir-model_files/figure-html/unnamed-chunk-6-1.png" alt="Simulated epidemic data" width="576"></p>
</div>
<div class="section level2">
<h2 id="bayesian-inference-with-pmmh">Bayesian Inference with PMMH<a class="anchor" aria-label="anchor" href="#bayesian-inference-with-pmmh"></a>
</h2>
<p>We are interested in performing Bayesian inference in this setup, and
define the priors as follows:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>λ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><msup><mi mathvariant="normal">l</mi><mo mathvariant="normal">+</mo></msup></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mn>1</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>γ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><msup><mi mathvariant="normal">l</mi><mo mathvariant="normal">+</mo></msup></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mn>2</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
    \lambda &amp;\sim \operatorname{Normal^+}(0, 1^2), \\
    \gamma &amp;\sim \operatorname{Normal^+}(0, 2^2),
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><msup><mi mathvariant="normal">l</mi><mo mathvariant="normal">+</mo></msup></mrow><annotation encoding="application/x-tex">\operatorname{Normal^+}</annotation></semantics></math>
denotes a truncated at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
normal distribution.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the log-prior for the parameters</span></span>
<span><span class="va">log_prior_lambda</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/HalfNormal.html" class="external-link">dhnorm</a></span><span class="op">(</span><span class="va">lambda</span>, sigma <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">log_prior_gamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/HalfNormal.html" class="external-link">dhnorm</a></span><span class="op">(</span><span class="va">gamma</span>, sigma <span class="op">=</span> <span class="fl">2</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">log_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  lambda <span class="op">=</span> <span class="va">log_prior_lambda</span>,</span>
<span>  gamma <span class="op">=</span> <span class="va">log_prior_gamma</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We now define the initial state, transition and likelihood functions
for the SIR model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_fn_epidemic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Return a matrix with particles rows; each row is the initial state (s, i)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">init_state</span>, each <span class="op">=</span> <span class="va">num_particles</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="va">num_particles</span>,</span>
<span>    byrow <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">transition_fn_epidemic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_particles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">particles</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">epidemic_step</span><span class="op">(</span><span class="va">state</span>, <span class="va">lambda</span>, <span class="va">gamma</span>, <span class="va">n_total</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">new_particles</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">log_likelihood_fn_epidemic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># particles is expected to be a matrix with columns (s, i)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">y</span>, lambda <span class="op">=</span> <span class="va">particles</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can run the PMMH algorithm to estimate the posterior
distribution. For this vignette we only use a small number of iterations
(1000) and 2 chains (and we also modify the tuning to only use 100
iterations with a burn-in of 10). In practice, these should be much
higher.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">bayesSSM</span><span class="fu">::</span><span class="fu"><a href="../reference/pmmh.html">pmmh</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">observations</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  init_fn <span class="op">=</span> <span class="va">init_fn_epidemic</span>,</span>
<span>  transition_fn <span class="op">=</span> <span class="va">transition_fn_epidemic</span>,</span>
<span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn_epidemic</span>,</span>
<span>  log_priors <span class="op">=</span> <span class="va">log_priors</span>,</span>
<span>  pilot_init_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.5</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">1</span>, gamma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  burn_in <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  num_chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  param_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"log"</span>, gamma <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  tune_control <span class="op">=</span> <span class="fu"><a href="../reference/default_tune_control.html">default_tune_control</a></span><span class="op">(</span>pilot_m <span class="op">=</span> <span class="fl">100</span>, pilot_burn_in <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1405</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running chain 1...</span></span>
<span><span class="co">#&gt; Running pilot chain for tuning...</span></span>
<span><span class="co">#&gt; Pilot chain posterior mean:</span></span>
<span><span class="co">#&gt;    lambda     gamma </span></span>
<span><span class="co">#&gt; 0.5744942 0.2023182</span></span>
<span><span class="co">#&gt; Pilot chain posterior covariance (on transformed space):</span></span>
<span><span class="co">#&gt;              lambda        gamma</span></span>
<span><span class="co">#&gt; lambda 0.0049477745 0.0008807493</span></span>
<span><span class="co">#&gt; gamma  0.0008807493 0.0001576646</span></span>
<span><span class="co">#&gt; Using 50 particles for PMMH:</span></span>
<span><span class="co">#&gt; Running Particle MCMC chain with tuned settings...</span></span>
<span><span class="co">#&gt; Running chain 2...</span></span>
<span><span class="co">#&gt; Running pilot chain for tuning...</span></span>
<span><span class="co">#&gt; Pilot chain posterior mean:</span></span>
<span><span class="co">#&gt;    lambda     gamma </span></span>
<span><span class="co">#&gt; 0.5228747 0.1919012</span></span>
<span><span class="co">#&gt; Pilot chain posterior covariance (on transformed space):</span></span>
<span><span class="co">#&gt;              lambda        gamma</span></span>
<span><span class="co">#&gt; lambda 0.0018259219 0.0005323758</span></span>
<span><span class="co">#&gt; gamma  0.0005323758 0.0001830201</span></span>
<span><span class="co">#&gt; Using 50 particles for PMMH:</span></span>
<span><span class="co">#&gt; Running Particle MCMC chain with tuned settings...</span></span>
<span><span class="co">#&gt; PMMH Results Summary:</span></span>
<span><span class="co">#&gt;  Parameter Mean   SD Median 2.5% 97.5% ESS  Rhat</span></span>
<span><span class="co">#&gt;     lambda 0.57 0.07   0.56 0.42  0.72 109 1.012</span></span>
<span><span class="co">#&gt;      gamma 0.21 0.02   0.21 0.17  0.24  70 1.020</span></span>
<span><span class="co">#&gt; Warning in bayesSSM::pmmh(y = observations, m = 1000, init_fn =</span></span>
<span><span class="co">#&gt; init_fn_epidemic, : Some ESS values are below 400, indicating poor mixing.</span></span>
<span><span class="co">#&gt; Consider running the chains for more iterations.</span></span>
<span><span class="co">#&gt; Warning in bayesSSM::pmmh(y = observations, m = 1000, init_fn = init_fn_epidemic, : </span></span>
<span><span class="co">#&gt; Some Rhat values are above 1.01, indicating that the chains have not converged. </span></span>
<span><span class="co">#&gt; Consider running the chains for more iterations and/or increase burn_in.</span></span></code></pre></div>
<p>We get convergence warnings as expected, but the posterior is still
centered around the true value.</p>
<p>We can access the chains and plot the densities:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chains</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">theta_chain</span></span></code></pre></div>
<p>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">chains</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambda</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">chain</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Density plot of lambda chains"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Chain"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stochastic-sir-model_files/figure-html/unnamed-chunk-11-1.png" alt="Density plot of lambda chains" width="576"></p>
<p>And for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">chains</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gamma</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">chain</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Density plot of gamma chains"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Chain"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stochastic-sir-model_files/figure-html/unnamed-chunk-12-1.png" alt="Density plot of gamma chains" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjarke Hautop.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
