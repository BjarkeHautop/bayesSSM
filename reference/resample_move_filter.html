<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Resample-Move Particle Filter (RMPF) — resample_move_filter • bayesSSM</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Resample-Move Particle Filter (RMPF) — resample_move_filter"><meta name="description" content="The Resample-Move Particle Filter applies a Metropolis-style move step after
resampling, improving particle diversity and avoiding sample impoverishment."><meta property="og:description" content="The Resample-Move Particle Filter applies a Metropolis-style move step after
resampling, improving particle diversity and avoiding sample impoverishment."><meta property="og:image" content="https://bjarkehautop.github.io/bayesSSM/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesSSM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bayesSSM.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/detailed-overview.html">Detailed Overview of bayesSSM Package</a></li>
    <li><a class="dropdown-item" href="../articles/stochastic-sir-model.html">Stochastic SIR Model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BjarkeHautop/bayesSSM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Resample-Move Particle Filter (RMPF)</h1>
      <small class="dont-index">Source: <a href="https://github.com/BjarkeHautop/bayesSSM/blob/master/R/resample_move_filter.R" class="external-link"><code>R/resample_move_filter.R</code></a></small>
      <div class="d-none name"><code>resample_move_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Resample-Move Particle Filter applies a Metropolis-style move step after
resampling, improving particle diversity and avoiding sample impoverishment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">resample_move_filter</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">num_particles</span>,</span>
<span>  <span class="va">init_fn</span>,</span>
<span>  <span class="va">transition_fn</span>,</span>
<span>  <span class="va">log_likelihood_fn</span>,</span>
<span>  <span class="va">move_fn</span>,</span>
<span>  obs_times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resample_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stratified"</span>, <span class="st">"systematic"</span>, <span class="st">"multinomial"</span><span class="op">)</span>,</span>
<span>  return_particles <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric vector or matrix of observations. Each row represents an
observation at a time step. If observations are not equally spaced, use the
<code>obs_times</code> argument.</p></dd>


<dt id="arg-num-particles">num_particles<a class="anchor" aria-label="anchor" href="#arg-num-particles"></a></dt>
<dd><p>A positive integer specifying the number of particles.</p></dd>


<dt id="arg-init-fn">init_fn<a class="anchor" aria-label="anchor" href="#arg-init-fn"></a></dt>
<dd><p>A function to initialize the particles. Should take
`num_particles` and return a matrix or vector of initial states. Additional
model parameters can be passed via <code>...</code>.</p></dd>


<dt id="arg-transition-fn">transition_fn<a class="anchor" aria-label="anchor" href="#arg-transition-fn"></a></dt>
<dd><p>A function for propagating particles. Should take
`particles` and optionally `t`. Additional model parameters via <code>...</code>.</p></dd>


<dt id="arg-log-likelihood-fn">log_likelihood_fn<a class="anchor" aria-label="anchor" href="#arg-log-likelihood-fn"></a></dt>
<dd><p>A function that returns the log-likelihood for each
particle given the current observation, particles, and optionally `t`.
Additional parameters via <code>...</code>.</p></dd>


<dt id="arg-move-fn">move_fn<a class="anchor" aria-label="anchor" href="#arg-move-fn"></a></dt>
<dd><p>A function that moves the resampled particles.
Takes `particles`, optionally `t`, and returns updated particles.
Can use <code>...</code> for model-specific arguments.</p></dd>


<dt id="arg-obs-times">obs_times<a class="anchor" aria-label="anchor" href="#arg-obs-times"></a></dt>
<dd><p>A numeric vector specifying observation time points. Must
match the number of rows in <code>y</code>, or defaults to <code>1:nrow(y)</code>.</p></dd>


<dt id="arg-resample-fn">resample_fn<a class="anchor" aria-label="anchor" href="#arg-resample-fn"></a></dt>
<dd><p>A string indicating the resampling method:
<code>"stratified"</code>, <code>"systematic"</code>, or <code>"multinomial"</code>.
Default is <code>"stratified"</code>.</p></dd>


<dt id="arg-return-particles">return_particles<a class="anchor" aria-label="anchor" href="#arg-return-particles"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, returns the full particle
and weight histories.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code>init_fn</code>,
<code>transition_fn</code>, and <code>log_likelihood_fn</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components:</p><dl><dt>state_est</dt>
<dd><p>Estimated states over time (weighted mean of particles).</p></dd>

  <dt>ess</dt>
<dd><p>Effective sample size at each time step.</p></dd>

  <dt>loglike</dt>
<dd><p>Total log-likelihood.</p></dd>

  <dt>loglike_history</dt>
<dd><p>Log-likelihood at each time step.</p></dd>

  <dt>algorithm</dt>
<dd><p>The filtering algorithm used.</p></dd>

  <dt>particles_history</dt>
<dd><p>Matrix of particle states over time
  (if <code>return_particles = TRUE</code>).</p></dd>

  <dt>weights_history</dt>
<dd><p>Matrix of particle weights over time
  (if <code>return_particles = TRUE</code>).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="the-resample-move-particle-filter-rmpf-">The Resample-Move Particle Filter (RMPF)<a class="anchor" aria-label="anchor" href="#the-resample-move-particle-filter-rmpf-"></a></h2>


<p>The Resample-Move Particle Filter enhances the standard particle filtering
framework by introducing a move step after resampling. After resampling
at time \(t\), particles \(\{x_t^{(i)}\}_{i=1}^N\) are propagated via
a Markov kernel \(K_t(x' \mid x)\) that leaves the target posterior
\(p(x_t \mid y_{1:t})\) invariant:
$$
  x_t^{(i)} \sim K_t(\cdot \mid x_t^{(i)}).
$$</p>
<p>This move step often uses a Metropolis-Hastings update that preserves
the posterior distribution as the invariant distribution of \(K_t\).</p>
<p>The goal of the move step is to mitigate particle impoverishment — the
collapse of diversity caused by resampling selecting only a few unique
particles — by rejuvenating particles and exploring the state space more
thoroughly. This leads to improved approximation of the filtering
distribution and reduces Monte Carlo error.</p>
<p>The <code>move_fn</code> argument represents this transition kernel and should
take the current particle set as input and return the updated particles.
Additional model-specific parameters may be passed via <code>...</code>.</p>
<p>Default resampling method is stratified resampling, which has lower variance
than multinomial resampling (Douc et al., 2005).</p>
<p>In this implementation, resampling is performed at every time step using the
specified method (default: stratified), followed immediately by the move
step. This follows the standard Resample-Move framework as described by
Gilks and Berzuini (2001). Unlike other particle filtering variants that may
use an ESS threshold to decide whether to resample, RMPF requires resampling
at every step to ensure the effectiveness of the subsequent rejuvenation
step.</p>
    </div>
    <div class="section level2">
    <h2 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a></h2>


<p>All particle filter implementations assume a discrete-time state-space model
consisting of:</p>
<ul><li><p>Latent states \(x_0, x_1, \ldots, x_T\) evolve via a
  Markov process.</p></li>
<li><p>Observations \(y_1, \ldots, y_T\) are conditionally independent
  given the latent states.</p></li>
</ul><p>The model is specified as:
$$x_0 \sim \mu_\theta$$
$$x_t \sim f_\theta(x_t \mid x_{t-1})$$
$$y_t \sim g_\theta(y_t \mid x_t)$$</p>
<p>where \(\theta\) denotes model parameters passed through <code>...</code>.
These functions are defined by:</p><ul><li><p><code>init_fn</code>: draws from \(\mu_\theta\)</p></li>
<li><p><code>transition_fn</code>: defines the transition density \(f_\theta\)</p></li>
<li><p><code>weight_fn</code>: defines the observation likelihood \(g_\theta\)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gilks, W. R., &amp; Berzuini, C. (2001). Following a moving target—Monte Carlo
inference for dynamic Bayesian models. Journal of the Royal Statistical
Society: Series B (Statistical Methodology), 63(1), 127–146.
<a href="https://doi.org/10.2307/2670179" class="external-link">doi:10.2307/2670179</a></p>
<p>Douc, R., Cappé, O., &amp; Moulines, E. (2005). Comparison of
Resampling Schemes for Particle Filtering.
Accessible at: <a href="https://arxiv.org/abs/cs/0507025" class="external-link">https://arxiv.org/abs/cs/0507025</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span><span class="op">)</span> <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a simple random-walk Metropolis move function</span></span></span>
<span class="r-in"><span><span class="va">move_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particle</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">particle</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_current</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">particle</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_proposal</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">proposal</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">log_p_proposal</span> <span class="op">-</span> <span class="va">log_p_current</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">particle</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="co"># Dummy data</span></span></span>
<span class="r-in"><span><span class="va">num_particles</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">resample_move_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="va">num_particles</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  move_fn <span class="op">=</span> <span class="va">move_fn</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"RMPF State Estimates"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="resample_move_filter-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With parameters</span></span></span>
<span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">move_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particle</span>, <span class="va">y</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">particle</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_curr</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">particle</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_prop</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">proposal</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">log_p_prop</span> <span class="op">-</span> <span class="va">log_p_curr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">particle</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">num_particles</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">resample_move_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="va">num_particles</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  move_fn <span class="op">=</span> <span class="va">move_fn</span>,</span></span>
<span class="r-in"><span>  mu <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  sigma <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"RMPF with Parameters"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="resample_move_filter-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With observation gaps</span></span></span>
<span class="r-in"><span><span class="va">simulate_ssm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_steps</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_steps</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_steps</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">num_steps</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">y</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">y</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">simulate_ssm</span><span class="op">(</span><span class="fl">10</span>, mu <span class="op">=</span> <span class="fl">1</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># skip t=4</span></span></span>
<span class="r-in"><span><span class="va">data_obs</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">obs_times</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">move_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particle</span>, <span class="va">y</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">particle</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_cur</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">particle</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">log_p_prop</span> <span class="op">&lt;-</span> <span class="fu">log_likelihood_fn</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, particles <span class="op">=</span> <span class="va">proposal</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">log_p_prop</span> <span class="op">-</span> <span class="va">log_p_cur</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">particle</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">resample_move_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">data_obs</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  move_fn <span class="op">=</span> <span class="va">move_fn</span>,</span></span>
<span class="r-in"><span>  obs_times <span class="op">=</span> <span class="va">obs_times</span>,</span></span>
<span class="r-in"><span>  mu <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  sigma <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"RMPF with Observation Gaps"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">data_obs</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="resample_move_filter-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjarke Hautop.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

