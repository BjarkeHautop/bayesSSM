<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Particle Marginal Metropolis-Hastings (PMMH) for State-Space Models — pmmh • bayesSSM</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Particle Marginal Metropolis-Hastings (PMMH) for State-Space Models — pmmh"><meta name="description" content="This function implements a Particle Marginal Metropolis-Hastings (PMMH)
algorithm to perform Bayesian inference in state-space models. It first
runs a pilot chain to tune the proposal distribution and the number of
particles for the particle filter, and then runs the main PMMH chain."><meta property="og:description" content="This function implements a Particle Marginal Metropolis-Hastings (PMMH)
algorithm to perform Bayesian inference in state-space models. It first
runs a pilot chain to tune the proposal distribution and the number of
particles for the particle filter, and then runs the main PMMH chain."><meta property="og:image" content="https://bjarkehautop.github.io/bayesSSM/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesSSM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bayesSSM.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/sir-model.html">sir-model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BjarkeHautop/bayesSSM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Particle Marginal Metropolis-Hastings (PMMH) for State-Space Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/BjarkeHautop/bayesSSM/blob/master/R/pmmh.R" class="external-link"><code>R/pmmh.R</code></a></small>
      <div class="d-none name"><code>pmmh.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements a Particle Marginal Metropolis-Hastings (PMMH)
algorithm to perform Bayesian inference in state-space models. It first
runs a pilot chain to tune the proposal distribution and the number of
particles for the particle filter, and then runs the main PMMH chain.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pmmh</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">m</span>,</span>
<span>  <span class="va">init_fn</span>,</span>
<span>  <span class="va">transition_fn</span>,</span>
<span>  <span class="va">log_likelihood_fn</span>,</span>
<span>  <span class="va">log_priors</span>,</span>
<span>  <span class="va">pilot_init_params</span>,</span>
<span>  <span class="va">burn_in</span>,</span>
<span>  num_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  obs_times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SISAR"</span>, <span class="st">"SISR"</span>, <span class="st">"SIS"</span><span class="op">)</span>,</span>
<span>  resample_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stratified"</span>, <span class="st">"systematic"</span>, <span class="st">"multinomial"</span><span class="op">)</span>,</span>
<span>  param_transform <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tune_control <span class="op">=</span> <span class="fu"><a href="default_tune_control.html">default_tune_control</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_latent_state_est <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric vector or matrix of observations. Each row represents an
observation at a time step.</p></dd>


<dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>An integer specifying the total number of MCMC iterations.</p></dd>


<dt id="arg-init-fn">init_fn<a class="anchor" aria-label="anchor" href="#arg-init-fn"></a></dt>
<dd><p>A function that initializes the particle states. It should
take `num_particles` as an argument for initializing the particles and return
a vector or matrix of initial particle states. It can include any
model-specific parameters as named arguments.</p></dd>


<dt id="arg-transition-fn">transition_fn<a class="anchor" aria-label="anchor" href="#arg-transition-fn"></a></dt>
<dd><p>A function describing the state transition model. It
should take `particles` as an argument and return the propagated particles.
The function can optionally depend on time by including a time step argument
`t`. It can include any model-specific parameters as named arguments.</p></dd>


<dt id="arg-log-likelihood-fn">log_likelihood_fn<a class="anchor" aria-label="anchor" href="#arg-log-likelihood-fn"></a></dt>
<dd><p>A function that computes the log-likelihoods for the
particles. It should take a `y` argument for the observations,
the current particles, and return a numeric vector of log-likelihood
values. The function can optionally depend on time by including a time step
argument `t`. It can include any model-specific parameters as named
arguments.</p></dd>


<dt id="arg-log-priors">log_priors<a class="anchor" aria-label="anchor" href="#arg-log-priors"></a></dt>
<dd><p>A list of functions for computing the log-prior of each
parameter.</p></dd>


<dt id="arg-pilot-init-params">pilot_init_params<a class="anchor" aria-label="anchor" href="#arg-pilot-init-params"></a></dt>
<dd><p>A list of initial parameter values. Should be a list
of length <code>num_chains</code> where each element is a named vector of initial
parameter values.</p></dd>


<dt id="arg-burn-in">burn_in<a class="anchor" aria-label="anchor" href="#arg-burn-in"></a></dt>
<dd><p>An integer indicating the number of initial MCMC iterations
to discard as burn-in.</p></dd>


<dt id="arg-num-chains">num_chains<a class="anchor" aria-label="anchor" href="#arg-num-chains"></a></dt>
<dd><p>An integer specifying the number of PMMH chains to run.</p></dd>


<dt id="arg-obs-times">obs_times<a class="anchor" aria-label="anchor" href="#arg-obs-times"></a></dt>
<dd><p>A numeric vector indicating the time points at which
observations in <code>y</code> are available. Must be of the same length as the
number of rows in <code>y</code>. If not specified, it is assumed that observations
are available at consecutive time steps, i.e., <code>obs_times = 1:nrow(y)</code>.</p></dd>


<dt id="arg-algorithm">algorithm<a class="anchor" aria-label="anchor" href="#arg-algorithm"></a></dt>
<dd><p>A character string specifying the particle filtering
algorithm to use. Must be one of <code>"SISAR"</code>, <code>"SISR"</code>, or
<code>"SIS"</code>. Defaults to <code>"SISAR"</code>.</p></dd>


<dt id="arg-resample-fn">resample_fn<a class="anchor" aria-label="anchor" href="#arg-resample-fn"></a></dt>
<dd><p>A character string specifying the resampling method.
Must be one of <code>"stratified"</code>, <code>"systematic"</code>, or
<code>"multinomial"</code>. Defaults to <code>"stratified"</code>.</p></dd>


<dt id="arg-param-transform">param_transform<a class="anchor" aria-label="anchor" href="#arg-param-transform"></a></dt>
<dd><p>An optional character vector that specifies the
transformation applied to each parameter before proposing. The proposal is
made using a multivariate normal distribution on the transformed scale.
Parameters are then mapped back to their original scale before evaluation.
Currently supports <code>"log"</code>, <code>"logit"</code>, and <code>"identity"</code>.
If <code>NULL</code>, the <code>"identity"</code> transformation is used for all
parameters.</p></dd>


<dt id="arg-tune-control">tune_control<a class="anchor" aria-label="anchor" href="#arg-tune-control"></a></dt>
<dd><p>A list of pilot tuning controls
(e.g., <code>pilot\_m</code>, <code>pilot\_reps</code>).
See <code><a href="default_tune_control.html">default_tune_control</a></code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical value indicating whether to print information about
pilot_run tuning. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-return-latent-state-est">return_latent_state_est<a class="anchor" aria-label="anchor" href="#arg-return-latent-state-est"></a></dt>
<dd><p>A logical value indicating whether to return
the latent state estimates for each time step. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional integer to set the seed for reproducibility.</p></dd>


<dt id="arg-num-cores">num_cores<a class="anchor" aria-label="anchor" href="#arg-num-cores"></a></dt>
<dd><p>An integer specifying the number of cores to use for
parallel processing. Defaults to 1. Each chain is assigned to its own core,
so the number of cores cannot exceed the number of chains
(<code>num_chains</code>). The progress information given to user is limited if
using more than one core.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><dl><dt><code>theta_chain</code></dt>
<dd><p>A dataframe of post burn-in parameter samples.</p></dd>

  <dt><code>latent_state_chain</code></dt>
<dd><p>If <code>return_latent_state_est</code> is
  <code>TRUE</code>, a list of matrices containing the latent state estimates
  for each time step.</p></dd>

  <dt><code>diagnostics</code></dt>
<dd><p>Diagnostics containing ESS and Rhat
  for each parameter (see <code><a href="ESS.html">ess</a></code> and <code><a href="rhat.html">rhat</a></code> for
  documentation).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The PMMH algorithm is essentially a Metropolis Hastings algorithm
where instead of using the exact likelihood it instead uses an estimated
using likelihood using a particle filter (see also
<code><a href="particle_filter.html">particle_filter</a></code>). Values are proposed using a multivariate
normal distribution in the transformed space. The proposal covariance is
estimated using the pilot chain.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Andrieu et al. (2010). Particle Markov chain Monte Carlo methods.
Journal of the Royal Statistical Society: Series B (Statistical Methodology),
72(3):269–342. doi: 10.1111/j.1467-9868.2009.00736.x</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">phi</span>, <span class="va">sigma_x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">phi</span> <span class="op">*</span> <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">sigma_y</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, sd <span class="op">=</span> <span class="va">sigma_y</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_prior_phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">phi</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_prior_sigma_x</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">sigma</span>, rate <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_prior_sigma_y</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">sigma</span>, rate <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  phi <span class="op">=</span> <span class="va">log_prior_phi</span>,</span></span>
<span class="r-in"><span>  sigma_x <span class="op">=</span> <span class="va">log_prior_sigma_x</span>,</span></span>
<span class="r-in"><span>  sigma_y <span class="op">=</span> <span class="va">log_prior_sigma_y</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Generate data</span></span></span>
<span class="r-in"><span><span class="va">t_val</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">t_val</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">t_val</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span></span>
<span class="r-in"><span><span class="va">sigma_x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">sigma_y</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">init_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span> <span class="op">*</span> <span class="va">init_state</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">init_state</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">t_val</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_x</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">init_state</span>, <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Should use much higher MCMC iterations in practice (m)</span></span></span>
<span class="r-in"><span><span class="va">pmmh_result</span> <span class="op">&lt;-</span> <span class="fu">pmmh</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  m <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  log_priors <span class="op">=</span> <span class="va">log_priors</span>,</span></span>
<span class="r-in"><span>  pilot_init_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">0.8</span>, sigma_x <span class="op">=</span> <span class="fl">1</span>, sigma_y <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">1</span>, sigma_x <span class="op">=</span> <span class="fl">0.5</span>, sigma_y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  burn_in <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  num_chains <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  param_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    phi <span class="op">=</span> <span class="st">"identity"</span>,</span></span>
<span class="r-in"><span>    sigma_x <span class="op">=</span> <span class="st">"log"</span>,</span></span>
<span class="r-in"><span>    sigma_y <span class="op">=</span> <span class="st">"log"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  tune_control <span class="op">=</span> <span class="fu"><a href="default_tune_control.html">default_tune_control</a></span><span class="op">(</span>pilot_m <span class="op">=</span> <span class="fl">500</span>, pilot_burn_in <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running chain 1...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running pilot chain for tuning...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 50 particles for PMMH:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Particle MCMC chain with tuned settings...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running chain 2...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running pilot chain for tuning...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 50 particles for PMMH:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Particle MCMC chain with tuned settings...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PMMH Results Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameter Mean   SD Median  2.5% 97.5% ESS  Rhat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        phi 0.54 1.03   0.66 -1.68  2.34  25 1.022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    sigma_x 1.55 1.23   1.29  0.08  4.75  64 1.044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    sigma_y 0.64 0.24   0.61  0.30  1.21  91 1.016</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some ESS values are below 400, indicating poor mixing. Consider running the chains for more iterations.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Some Rhat values are above 1.01, indicating that the chains have not converged. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider running the chains for more iterations and/or increase burn_in.</span>
<span class="r-in"><span><span class="co"># Convergence warning is expected with such low MCMC iterations.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose we have data for t=1,2,3,5,6,7,8,9,10 (i.e., missing at t=4)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">obs_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">obs_times</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify observation times in the pmmh using obs_times</span></span></span>
<span class="r-in"><span><span class="va">pmmh_result</span> <span class="op">&lt;-</span> <span class="fu">pmmh</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  m <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  log_priors <span class="op">=</span> <span class="va">log_priors</span>,</span></span>
<span class="r-in"><span>  pilot_init_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">0.8</span>, sigma_x <span class="op">=</span> <span class="fl">1</span>, sigma_y <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">1</span>, sigma_x <span class="op">=</span> <span class="fl">0.5</span>, sigma_y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  burn_in <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  num_chains <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  obs_times <span class="op">=</span> <span class="va">obs_times</span>,</span></span>
<span class="r-in"><span>  param_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    phi <span class="op">=</span> <span class="st">"identity"</span>,</span></span>
<span class="r-in"><span>    sigma_x <span class="op">=</span> <span class="st">"log"</span>,</span></span>
<span class="r-in"><span>    sigma_y <span class="op">=</span> <span class="st">"log"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  tune_control <span class="op">=</span> <span class="fu"><a href="default_tune_control.html">default_tune_control</a></span><span class="op">(</span>pilot_m <span class="op">=</span> <span class="fl">500</span>, pilot_burn_in <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running chain 1...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running pilot chain for tuning...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 50 particles for PMMH:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Particle MCMC chain with tuned settings...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running chain 2...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running pilot chain for tuning...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 50 particles for PMMH:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Particle MCMC chain with tuned settings...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PMMH Results Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameter Mean   SD Median  2.5% 97.5% ESS  Rhat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        phi 0.14 1.21   0.37 -2.24  2.23  36 1.088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    sigma_x 1.68 1.21   1.49  0.07  4.59  68 1.046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    sigma_y 0.67 0.24   0.62  0.33  1.28  83 1.017</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some ESS values are below 400, indicating poor mixing. Consider running the chains for more iterations.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Some Rhat values are above 1.01, indicating that the chains have not converged. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider running the chains for more iterations and/or increase burn_in.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjarke Hautop.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

