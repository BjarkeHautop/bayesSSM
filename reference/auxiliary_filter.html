<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Auxiliary Particle Filter (APF) — auxiliary_filter • bayesSSM</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Auxiliary Particle Filter (APF) — auxiliary_filter"><meta name="description" content="The Auxiliary Particle Filter enhances the bootstrap filter by using a
look ahead step: particles are weighted based on the predicted likelihood of
the next observation before resampling. This anticipatory weighting reduces
particle degeneracy and improves filter efficiency."><meta property="og:description" content="The Auxiliary Particle Filter enhances the bootstrap filter by using a
look ahead step: particles are weighted based on the predicted likelihood of
the next observation before resampling. This anticipatory weighting reduces
particle degeneracy and improves filter efficiency."><meta property="og:image" content="https://bjarkehautop.github.io/bayesSSM/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesSSM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bayesSSM.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/detailed-overview.html">Detailed Overview of bayesSSM Package</a></li>
    <li><a class="dropdown-item" href="../articles/stochastic-sir-model.html">Stochastic SIR Model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BjarkeHautop/bayesSSM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Auxiliary Particle Filter (APF)</h1>
      <small class="dont-index">Source: <a href="https://github.com/BjarkeHautop/bayesSSM/blob/master/R/auxiliary_filter.R" class="external-link"><code>R/auxiliary_filter.R</code></a></small>
      <div class="d-none name"><code>auxiliary_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Auxiliary Particle Filter enhances the bootstrap filter by using a
look ahead step: particles are weighted based on the predicted likelihood of
the next observation before resampling. This anticipatory weighting reduces
particle degeneracy and improves filter efficiency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">auxiliary_filter</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">num_particles</span>,</span>
<span>  <span class="va">init_fn</span>,</span>
<span>  <span class="va">transition_fn</span>,</span>
<span>  <span class="va">log_likelihood_fn</span>,</span>
<span>  <span class="va">aux_log_likelihood_fn</span>,</span>
<span>  obs_times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resample_algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SISAR"</span>, <span class="st">"SISR"</span>, <span class="st">"SIS"</span><span class="op">)</span>,</span>
<span>  resample_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stratified"</span>, <span class="st">"systematic"</span>, <span class="st">"multinomial"</span><span class="op">)</span>,</span>
<span>  threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_particles <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric vector or matrix of observations. Each row represents an
observation at a time step. If observations are not equally spaced, use the
<code>obs_times</code> argument.</p></dd>


<dt id="arg-num-particles">num_particles<a class="anchor" aria-label="anchor" href="#arg-num-particles"></a></dt>
<dd><p>A positive integer specifying the number of particles.</p></dd>


<dt id="arg-init-fn">init_fn<a class="anchor" aria-label="anchor" href="#arg-init-fn"></a></dt>
<dd><p>A function to initialize the particles. Should take
`num_particles` and return a matrix or vector of initial states. Additional
model parameters can be passed via <code>...</code>.</p></dd>


<dt id="arg-transition-fn">transition_fn<a class="anchor" aria-label="anchor" href="#arg-transition-fn"></a></dt>
<dd><p>A function for propagating particles. Should take
`particles` and optionally `t`. Additional model parameters via <code>...</code>.</p></dd>


<dt id="arg-log-likelihood-fn">log_likelihood_fn<a class="anchor" aria-label="anchor" href="#arg-log-likelihood-fn"></a></dt>
<dd><p>A function that returns the log-likelihood for each
particle given the current observation, particles, and optionally `t`.
Additional parameters via <code>...</code>.</p></dd>


<dt id="arg-aux-log-likelihood-fn">aux_log_likelihood_fn<a class="anchor" aria-label="anchor" href="#arg-aux-log-likelihood-fn"></a></dt>
<dd><p>A function that computes the log-likelihood of
the next observation given the current particles. It should accept
arguments `y`, `particles`, optionally `t`, and any additional model-specific
parameters via <code>...</code>. It returns a numeric vector of log-likelihoods.</p></dd>


<dt id="arg-obs-times">obs_times<a class="anchor" aria-label="anchor" href="#arg-obs-times"></a></dt>
<dd><p>A numeric vector specifying observation time points. Must
match the number of rows in <code>y</code>, or defaults to <code>1:nrow(y)</code>.</p></dd>


<dt id="arg-resample-algorithm">resample_algorithm<a class="anchor" aria-label="anchor" href="#arg-resample-algorithm"></a></dt>
<dd><p>A character string specifying the filtering
resample algorithm:
<code>"SIS"</code> for no resampling, <code>"SISR"</code> for resampling at every time
step, or <code>"SISAR"</code> for adaptive resampling when ESS
drops below <code>threshold</code>. Using <code>"SISR"</code> or <code>"SISAR"</code> to
avoid weight degeneracy is recommedended. Default is <code>"SISAR"</code>.</p></dd>


<dt id="arg-resample-fn">resample_fn<a class="anchor" aria-label="anchor" href="#arg-resample-fn"></a></dt>
<dd><p>A string indicating the resampling method:
<code>"stratified"</code>, <code>"systematic"</code>, or <code>"multinomial"</code>.
Default is <code>"stratified"</code>.</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>A numeric value specifying the ESS threshold for
<code>"SISAR"</code>. Defaults to <code>num_particles / 2</code>.</p></dd>


<dt id="arg-return-particles">return_particles<a class="anchor" aria-label="anchor" href="#arg-return-particles"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, returns the full particle
and weight histories.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code>init_fn</code>,
<code>transition_fn</code>, and <code>log_likelihood_fn</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components:</p><dl><dt>state_est</dt>
<dd><p>Estimated states over time (weighted mean of particles).</p></dd>

  <dt>ess</dt>
<dd><p>Effective sample size at each time step.</p></dd>

  <dt>loglike</dt>
<dd><p>Total log-likelihood.</p></dd>

  <dt>loglike_history</dt>
<dd><p>Log-likelihood at each time step.</p></dd>

  <dt>algorithm</dt>
<dd><p>The filtering algorithm used.</p></dd>

  <dt>particles_history</dt>
<dd><p>Matrix of particle states over time
  (if <code>return_particles = TRUE</code>).</p></dd>

  <dt>weights_history</dt>
<dd><p>Matrix of particle weights over time
  (if <code>return_particles = TRUE</code>).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="the-auxiliary-particle-filter-apf-">The Auxiliary Particle Filter (APF)<a class="anchor" aria-label="anchor" href="#the-auxiliary-particle-filter-apf-"></a></h2>



<p>The Auxiliary Particle Filter (APF) was introduced by Pitt and Shephard
(1999) to improve upon the standard bootstrap filter by incorporating a
look ahead step. Before resampling at time \(t\), particles are weighted by
an auxiliary weight proportional to an estimate of the likelihood of the next
observation, guiding resampling to favor particles likely to contribute to
future predictions.</p>
<p>Specifically, if \(w_{t-1}^i\) are the normalized weights and
\(x_{t-1}^i\) are the particles at time \(t-1\), then auxiliary weights
are computed as
$$
  \tilde{w}_t^i \propto w_{t-1}^i \, p(y_t | \mu_t^i),
$$
where \(\mu_t^i\) is a predictive summary (e.g., the expected next state)
of the particle \(x_{t-1}^i\). Resampling is performed using
\(\tilde{w}_t^i\) instead of \(w_{t-1}^i\).
This can reduce the variance of the importance weights at time \(t\) and
help mitigate particle degeneracy, especially if the auxiliary weights are
chosen well.</p>
<p>Default resampling method is stratified resampling, which has lower variance
than multinomial resampling (Douc et al., 2005).</p>
    </div>
    <div class="section level2">
    <h2 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a></h2>


<p>All particle filter implementations assume a discrete-time state-space model
consisting of:</p>
<ul><li><p>Latent states \(x_0, x_1, \ldots, x_T\) evolve via a
  Markov process.</p></li>
<li><p>Observations \(y_1, \ldots, y_T\) are conditionally independent
  given the latent states.</p></li>
</ul><p>The model is specified as:
$$x_0 \sim \mu_\theta$$
$$x_t \sim f_\theta(x_t \mid x_{t-1})$$
$$y_t \sim g_\theta(y_t \mid x_t)$$</p>
<p>where \(\theta\) denotes model parameters passed through <code>...</code>.
These functions are defined by:</p><ul><li><p><code>init_fn</code>: draws from \(\mu_\theta\)</p></li>
<li><p><code>transition_fn</code>: defines the transition density \(f_\theta\)</p></li>
<li><p><code>weight_fn</code>: defines the observation likelihood \(g_\theta\)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pitt, M. K., &amp; Shephard, N. (1999). Filtering via simulation: Auxiliary
particle filters. Journal of the American Statistical Association, 94(446),
590–599. <a href="https://doi.org/10.1080/01621459.1999.10474153" class="external-link">doi:10.1080/01621459.1999.10474153</a></p>
<p>Douc, R., Cappé, O., &amp; Moulines, E. (2005). Comparison of
Resampling Schemes for Particle Filtering.
Accessible at: <a href="https://arxiv.org/abs/cs/0507025" class="external-link">https://arxiv.org/abs/cs/0507025</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span><span class="op">)</span> <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">aux_log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Predict next state (mean stays same) and compute log p(y | x)</span></span></span>
<span class="r-in"><span>  <span class="va">mean_forecast</span> <span class="op">&lt;-</span> <span class="va">particles</span> <span class="co"># since E[x'] = x in this model</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">mean_forecast</span>, sd <span class="op">=</span> <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="co"># dummy data</span></span></span>
<span class="r-in"><span><span class="va">num_particles</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">auxiliary_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="va">num_particles</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  aux_log_likelihood_fn <span class="op">=</span> <span class="va">aux_log_likelihood_fn</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"APF: State Estimates"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="auxiliary_filter-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- With parameters ----</span></span></span>
<span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">aux_log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Forecast mean of x' given x, then evaluate p(y | forecast)</span></span></span>
<span class="r-in"><span>  <span class="va">forecast</span> <span class="op">&lt;-</span> <span class="va">particles</span> <span class="op">+</span> <span class="va">mu</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">forecast</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="co"># dummy data</span></span></span>
<span class="r-in"><span><span class="va">num_particles</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">auxiliary_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="va">num_particles</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  aux_log_likelihood_fn <span class="op">=</span> <span class="va">aux_log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  mu <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  sigma <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"APF with Parameters"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="auxiliary_filter-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- With observation gaps ----</span></span></span>
<span class="r-in"><span><span class="va">simulate_ssm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_steps</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_steps</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_steps</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">num_steps</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">y</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">y</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">simulate_ssm</span><span class="op">(</span><span class="fl">10</span>, mu <span class="op">=</span> <span class="fl">1</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Missing at t = 4</span></span></span>
<span class="r-in"><span><span class="va">data_obs</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">obs_times</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_particles</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num_particles</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">particles</span>, <span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">particles</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">particles</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">particles</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">aux_log_likelihood_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">particles</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">forecast</span> <span class="op">&lt;-</span> <span class="va">particles</span> <span class="op">+</span> <span class="va">mu</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">forecast</span>, sd <span class="op">=</span> <span class="va">sigma</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">num_particles</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">auxiliary_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">data_obs</span>,</span></span>
<span class="r-in"><span>  num_particles <span class="op">=</span> <span class="va">num_particles</span>,</span></span>
<span class="r-in"><span>  init_fn <span class="op">=</span> <span class="va">init_fn</span>,</span></span>
<span class="r-in"><span>  transition_fn <span class="op">=</span> <span class="va">transition_fn</span>,</span></span>
<span class="r-in"><span>  log_likelihood_fn <span class="op">=</span> <span class="va">log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  aux_log_likelihood_fn <span class="op">=</span> <span class="va">aux_log_likelihood_fn</span>,</span></span>
<span class="r-in"><span>  obs_times <span class="op">=</span> <span class="va">obs_times</span>,</span></span>
<span class="r-in"><span>  mu <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  sigma <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"APF with Observation Gaps"</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state_est</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">data_obs</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="auxiliary_filter-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjarke Hautop.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

